DROP TABLE SALES;
DROP TABLE ORD;
DROP TABLE CUST;
DROP TABLE PROD;
CREATE TABLE CUST(
CUST_CD VARCHAR(10) NOT NULL,
CUST_NM VARCHAR(20) NOT NULL,
CUST_AGE	INT		DEFAULT 0,
CUST_LVL VARCHAR(10),
CUST_JOB VARCHAR(20),
CUST_POINT INT DEFAULT 0,
PRIMARY KEY(CUST_CD)
);

CREATE TABLE PROD(
PROD_CD VARCHAR(10) NOT NULL,
PROD_NM VARCHAR(20)	NOT NULL,
PROD_QY	INT					DEFAULT 0,
PROD_PRI	DECIMAL(18,4)	DEFAULT 0,
PROD_VEND VARCHAR(20),
PRIMARY KEY(PROD_CD),
CHECK(PROD_QY>=0 AND PROD_QY<=10000)
);
CREATE TABLE ORD(
ORD_CD VARCHAR(10) NOT NULL,
CUST_CD VARCHAR(10),
PROD_CD VARCHAR(10)	DEFAULT 0,
ORD_QTY		INT,
ORD_ADD VARCHAR(20),
ORD_REGDT	DATETIME	DEFAULT GETDATE(),
PRIMARY KEY(ORD_CD),
FOREIGN KEY(CUST_CD) REFERENCES CUST(CUST_CD),
FOREIGN KEY(PROD_CD) REFERENCES PROD(PROD_CD)
);
CREATE TABLE SALES(
ORD_CD VARCHAR(10) NOT NULL,
SALES_PRICE INT	DEFAULT 0,
SALES_REGDT	DATETIME,
SALES_ADD	VARCHAR(20),
CUST_NM		VARCHAR(20),
PRIMARY  KEY(ORD_CD),
FOREIGN KEY(ORD_CD) REFERENCES ORD(ORD_CD)
);


INSERT INTO CUST VALUES('apple', '정소화', 20, 'gold', '학생', 1000);
INSERT INTO CUST VALUES('banana', '김선우', 25, 'vip', '간호사', 2500);
INSERT INTO CUST VALUES('carrot', '고명석', 28, 'gold', '교사', 4500);
INSERT INTO CUST VALUES('orange', '김용욱', 22, 'silver', '학생', 0);
INSERT INTO CUST VALUES('melon', '성원용', 35, 'gold', '회사원', 5000);
INSERT INTO CUST VALUES('peach', '오형준', NULL, 'silver', '의사', 300);
INSERT INTO CUST VALUES('pear', '채광주', 31, 'silver', '회사원', 500);
INSERT INTO CUST VALUES('grape', '가나다', NULL, 'silver', '학생', 300);
INSERT INTO CUST VALUES('juice', '마바사', 32, 'silver', '회사원', 500);


INSERT INTO PROD VALUES('p01', '그냥만두', 5000, 4500, '대한식품');
INSERT INTO PROD VALUES('p02', '매운쫄면', 2500, 5500, '민국푸드');
INSERT INTO PROD VALUES('p03', '쿵떡파이', 3600, 2600, '한빛제과');
INSERT INTO PROD VALUES('p04', '맛난초콜릿', 1250, 2500, '한빛제과');
INSERT INTO PROD VALUES('p05', '얼큰라면', 2200, 1200, '대한식품');
INSERT INTO PROD VALUES('p06', '통통우동', 1000, 1550, '민국푸드');
INSERT INTO PROD VALUES('p07', '달콤비스킷', 1650, 1500, '한빛제과');
INSERT INTO PROD VALUES('p08', '배고푸딩', 1000, 1600, '한빛제과');
INSERT INTO PROD VALUES('p09', '든든햇반', 1650, 1500, '민국푸드');
INSERT INTO PROD VALUES('p10', '맛난김치', 2300, 6000, '민국푸드');

INSERT INTO ORD VALUES('o01','apple', 'p03', 10, '서울시 마포구', '2019-01-01');
INSERT INTO ORD VALUES('o02','melon', 'p01', 5, '인천시 계양구', '2020-01-10');
INSERT INTO ORD VALUES('o03','banana', 'p06', 45, '경기도 부천시', '2019-01-11');
INSERT INTO ORD VALUES('o04','carrot', 'p02', 8, '부산시 금정구', '2019-02-01');
INSERT INTO ORD VALUES('o05','melon', 'p06', 36, '경기도 용인시', '2020-02-20');
INSERT INTO ORD VALUES('o06','banana', 'p01', 19, '충청북도 보은군', '2019-03-02');
INSERT INTO ORD VALUES('o07','apple', 'p03', 22, '서울시 영등포구', '2021-03-15');
INSERT INTO ORD VALUES('o08','pear', 'p02', 50, '강원도 춘천시', '2019-04-10');
INSERT INTO ORD VALUES('o09','banana', 'p04', 15, '전라남도 목포시', '2021-04-11');
INSERT INTO ORD VALUES('o10','carrot', 'p03', 20, '경기도 안양시', '2020-05-22');


ALTER TABLE ORD ADD ORD_PRI INT DEFAULT 0;
INSERT INTO SALES VALUES('o01',0, '2019-01-11', '경기도 용인시', '김용욱');
INSERT INTO SALES VALUES('o02',0, '2019-01-11', '경기도 용인시', '김용욱');
INSERT INTO SALES VALUES('o03',0, '2019-01-11', '경기도 용인시', '김용욱');

UPDATE ORD
SET ORD_PRI = ORD.ORD_QTY*PROD.PROD_PRI
FROM ORD, PROD
WHERE ORD.PROD_CD=PROD.PROD_CD;

UPDATE SALES
SET SALES_PRICE = ORD.ORD_PRI
FROM ORD, SALES
WHERE SALES.ORD_CD=ORD.ORD_CD;

UPDATE SALES
SET SALES_ADD = ORD.ORD_ADD
FROM ORD, SALES
WHERE SALES.ORD_CD=ORD.ORD_CD;

UPDATE SALES
SET SALES_REGDT = ORD.ORD_REGDT
FROM ORD, SALES
WHERE SALES.ORD_CD=ORD.ORD_CD;

UPDATE SALES
SET CUST_NM = CUST.CUST_NM
FROM CUST, SALES, ORD
WHERE SALES.ORD_CD=ORD.ORD_CD AND ORD.CUST_CD=CUST.CUST_CD;

DELETE FROM SALES
WHERE CUST_NM=(SELECT CUST_NM FROM CUST WHERE CUST_CD='apple');
DELETE FROM ORD
WHERE CUST_CD='apple';
DELETE FROM CUST 
WHERE CUST_CD='apple';

DELETE FROM SALES
WHERE CUST_NM=(SELECT CUST_NM FROM CUST WHERE CUST_CD='orange');
DELETE FROM ORD
WHERE CUST_CD='orange';
DELETE FROM CUST 
WHERE CUST_CD='orange';

UPDATE ORD
SET ORD_QTY+=20
FROM ORD
WHERE CUST_CD='banana' AND PROD_CD='p04';

UPDATE CUST
SET CUST_POINT=5000
WHERE CUST_CD='grape' OR CUST_CD='juice';

UPDATE CUST
SET CUST_POINT*=1.5
WHERE CUST_CD NOT IN ('grape','juice');

UPDATE CUST
SET CUST_POINT+=2500
WHERE CUST_CD = 'banana';

INSERT INTO ORD VALUES('o11','melon', 'p05', 30, '인천시 연수구', '2021-04-09', 0);
INSERT INTO SALES VALUES('o04',0, '2021-04-11', '경기도 용인시', '김용욱');
INSERT INTO SALES VALUES('o09',0, '2021-04-11', '경기도 용인시', '김용욱');
INSERT INTO SALES VALUES('o10',0, '2021-04-11', '경기도 용인시', '김용욱');

UPDATE SALES
SET SALES_PRICE = ORD.ORD_PRI
FROM ORD, SALES
WHERE SALES.ORD_CD=ORD.ORD_CD;

UPDATE SALES
SET SALES_ADD = ORD.ORD_ADD
FROM ORD, SALES
WHERE SALES.ORD_CD=ORD.ORD_CD;

UPDATE SALES
SET SALES_REGDT = ORD.ORD_REGDT
FROM ORD, SALES
WHERE SALES.ORD_CD=ORD.ORD_CD;

UPDATE SALES
SET CUST_NM = CUST.CUST_NM
FROM CUST, SALES, ORD
WHERE SALES.ORD_CD=ORD.ORD_CD AND ORD.CUST_CD=CUST.CUST_CD;

SELECT * FROM CUST;
SELECT * FROM PROD;
SELECT * FROM ORD;
SELECT * FROM SALES;
